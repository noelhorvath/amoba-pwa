"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4393],{4393:(H,E,s)=>{s.r(E),s.d(E,{SettingsModule:()=>V});var g=s(9808),a=s(5636),l=s(2382),e=s(4893);let y=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.ez,a.Pc,l.u5,l.UX]]}),o})();var b=s(3136),f=s(655),h=s(9646),Z=s(6805),x=s(930),T=s(5831),G=s(8961),u=s(4899),v=s(8496),C=s(3900),M=s(4004),O=s(262),U=s(6215),w=s(5403),B=s(8306),J=s(8421);let A=(()=>{class o{constructor(){}getUserEmotesUrl(t){return o.API_URL+`/users/${t}/emotes`}getEmotes(t,n){return function _(o,i={}){const{selector:t}=i,n=(0,f._T)(i,["selector"]);return new B.y(r=>{const m=new AbortController,{signal:c}=m;let d=!0;const{signal:S}=n;if(S)if(S.aborted)m.abort();else{const p=()=>{c.aborted||m.abort()};S.addEventListener("abort",p),r.add(()=>S.removeEventListener("abort",p))}const D=Object.assign(Object.assign({},n),{signal:c}),F=p=>{d=!1,r.error(p)};return fetch(o,D).then(p=>{t?(0,J.Xf)(t(p)).subscribe((0,w.x)(r,void 0,()=>{d=!1,r.complete()},F)):(d=!1,r.next(p),r.complete())}).catch(F),()=>{d&&m.abort()}})}(this.getUserEmotesUrl(t)).pipe((0,C.w)(r=>r.json()),(0,M.U)(r=>{r instanceof Array||console.error(r.message);const m=r instanceof Array?r.filter(c=>c.height[0]===c.width[0]).map(c=>new U.v(c)).sort((c,d)=>c.name.localeCompare(d.name)):void 0;return n&&(null==m||m.push(n)),m}),(0,O.K)(()=>(console.error("Failed to fetch emotes!"),(0,h.of)(void 0))))}}return o.API_URL="https://api.7tv.app/v2",o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"any"}),o})();var Q=s(859);function k(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"ion-label",3),e._uU(2),e.qZA(),e.BQk()),2&o){const t=e.oxw();e.xp6(2),e.Oqu(t.player.charAt(0).toUpperCase()+t.player.slice(1)+" emote")}}function L(o,i){if(1&o&&(e.TgZ(0,"ion-select-option",6),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function N(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"ion-select",4),e.YNc(2,L,2,2,"ion-select-option",5),e.qZA(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("formControl",t.control)("selectedText",null==t.control.value?null:t.control.value.name),e.xp6(1),e.Q6J("ngForOf",t.emotes)("ngForTrackBy",t.trackByEmote)}}function z(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"ion-thumbnail",7),e._UZ(2,"ion-img",8),e.qZA(),e.BQk()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("src",null==t.control||null==t.control.value||null==t.control.value.urls?null:t.control.value.urls[3])}}function P(o,i){1&o&&(e.TgZ(0,"ion-thumbnail",9),e._UZ(1,"ion-spinner",10),e.qZA())}let X=(()=>{class o{constructor(){}trackByEmote(t,n){return n.id}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-emote-select-item"]],inputs:{emotes:"emotes",player:"player",control:"control"},decls:6,vars:4,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["loading",""],["position","floating"],["interface","popover",1,"ion-padding-bottom",3,"formControl","selectedText"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[3,"value"],["slot","end"],[3,"src"],[1,"ion-text-center"],["color","secondary","name","lines"]],template:function(t,n){if(1&t&&(e.TgZ(0,"ion-item"),e.YNc(1,k,3,1,"ng-container",0),e.YNc(2,N,3,4,"ng-container",0),e.YNc(3,z,3,1,"ng-container",1),e.YNc(4,P,2,0,"ng-template",null,2,e.W1O),e.qZA()),2&t){const r=e.MAs(5);e.xp6(1),e.Q6J("ngIf",n.player),e.xp6(1),e.Q6J("ngIf",n.control),e.xp6(1),e.Q6J("ngIf",null==n.control?null:n.control.value)("ngIfElse",r)}},directives:[a.Ie,g.O5,a.Q$,a.t9,a.QI,l.JJ,l.oH,g.sg,a.n0,a.Bs,a.Xz,a.PQ],styles:["[_nghost-%COMP%]   ion-select[_ngcontent-%COMP%]{max-width:100%;width:100%;text-align:center;justify-content:center}[_nghost-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{background:#ffffff}"]}),o})();function Y(o,i){if(1&o&&(e.TgZ(0,"ion-select-option",13),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function j(o,i){if(1&o&&(e.TgZ(0,"ion-select-option",13),e._uU(1),e.qZA()),2&o){const t=i.$implicit,n=e.oxw();e.Q6J("value",t),e.xp6(1),e.hij(" ",n.gameModeToString(t)," ")}}function q(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"ion-row")(2,"ion-col")(3,"ion-item")(4,"ion-label",14),e._uU(5),e.qZA(),e.TgZ(6,"ion-range",15)(7,"ion-label",16),e._uU(8),e.qZA(),e.TgZ(9,"ion-label",17),e._uU(10),e.qZA()()()()(),e.BQk()),2&o){const t=e.oxw();e.xp6(5),e.Oqu("AI game speed: "+t.gameSettingsFormGroup.controls.aiGameSpeed.value),e.xp6(3),e.Oqu("0"),e.xp6(2),e.Oqu("5000")}}const R=[{path:"",component:(()=>{class o{constructor(t,n,r,m,c){this.emoteApi=t,this.engine=n,this.gameSettingsService=r,this.formBuilder=m,this.messageService=c,this.gameModes=[v.G.REAL_VS_REAL,v.G.REAL_VS_AI,v.G.AI_VS_AI],this.gameSettingsFormGroup=this.formBuilder.group({boardSize:[void 0],whiteEmote:[void 0],blackEmote:[void 0],gameMode:[void 0],emotesSource:[void 0],aiGameSpeed:[void 0,[l.kI.min(0),l.kI.max(5e3)]]}),this.selectedBoardSize=5,this.boardSizes=o.createRangeArray(T.$.MIN_SIZE,T.$.MAX_SIZE),this.emotes={white:(0,h.of)([u.B.DEFAULT_WHITE_EMOTE]),black:(0,h.of)([u.B.DEFAULT_BLACK_EMOTE])},this.resetGameSettingsForm(!1)}static createRangeArray(t,n){if(t<0||n<0)throw new Error("Invalid range!");if(n<t){const r=n;n=t,t=r}return Array(n-t+1).fill(0).map((r,m)=>t+m)}gameModeToString(t){return G.G.gameModeToString(t)}resetGameSettingsForm(t=!0){this.gameSettingsService.get().then(n=>(0,f.mG)(this,void 0,void 0,function*(){this.gameSettingsFormGroup.patchValue({boardSize:n.boardSize,whiteEmote:n.whiteEmote,blackEmote:n.blackEmote,gameMode:n.gameMode,emotesSource:n.emotesSource,aiGameSpeed:n.aiGameSpeed}),n.emotesSource&&(this.emotes.white=this.emoteApi.getEmotes(this.gameSettingsFormGroup.value.emotesSource,u.B.DEFAULT_WHITE_EMOTE),this.emotes.black=this.emoteApi.getEmotes(this.gameSettingsFormGroup.value.emotesSource,u.B.DEFAULT_BLACK_EMOTE)),t&&(yield this.messageService.createToast({header:"Settings",message:"Game settings have been reset to saved settings!",color:"success",position:"top",buttons:["X"],duration:3e3}))})).catch(()=>(0,f.mG)(this,void 0,void 0,function*(){t&&(yield this.messageService.createToast({header:"Settings error",message:"Failed to reset game settings!",color:"danger",position:"top",buttons:["X"],duration:3e3}))}))}saveGameSettings(){return(0,f.mG)(this,void 0,void 0,function*(){try{return this.engine.isGameRunning()?this.messageService.createToast({header:"Settings error",message:"Game settings cannot be changed while a game is running!",color:"danger",position:"top",buttons:["X"],duration:3e3}):void 0!==this.gameSettingsFormGroup.value.blackEmote&&void 0!==this.gameSettingsFormGroup.value.whiteEmote&&this.gameSettingsFormGroup.value.whiteEmote.id===this.gameSettingsFormGroup.value.blackEmote.id||this.gameSettingsFormGroup.value.aiGameSpeed<0||this.gameSettingsFormGroup.value.aiGameSpeed>5e3?this.messageService.createToast({header:"Settings error",message:"Black and white emotes must be different!",color:"danger",position:"top",buttons:["X"],duration:3e3}):(yield this.gameSettingsService.update({blackEmote:this.gameSettingsFormGroup.value.blackEmote,whiteEmote:this.gameSettingsFormGroup.value.whiteEmote,boardSize:this.gameSettingsFormGroup.value.boardSize,gameMode:this.gameSettingsFormGroup.value.gameMode,emotesSource:this.gameSettingsFormGroup.value.emotesSource,aiGameSpeed:this.gameSettingsFormGroup.value.aiGameSpeed}),this.messageService.createToast({header:"Settings",message:"Game settings have been saved!",color:"success",position:"top",buttons:["X"],duration:3e3}))}catch(t){return this.messageService.createToast({header:"Settings error",message:"Failed to save game settings!",color:"danger",position:"top",buttons:["X"],duration:3e3})}})}isGameSettingsFormInvalid(){var t,n;return this.engine.isGameRunning()||this.gameSettingsFormGroup.invalid||void 0!==this.gameSettingsFormGroup.value.blackEmote&&void 0!==this.gameSettingsFormGroup.value.whiteEmote&&(null===(t=this.gameSettingsFormGroup.value.blackEmote)||void 0===t?void 0:t.id)===(null===(n=this.gameSettingsFormGroup.value.whiteEmote)||void 0===n?void 0:n.id)}updateEmotes(){return(0,f.mG)(this,void 0,void 0,function*(){const t=yield function I(o,i){const t="object"==typeof i;return new Promise((n,r)=>{const m=new x.Hp({next:c=>{n(c),m.unsubscribe()},error:r,complete:()=>{t?n(i.defaultValue):r(new Z.K)}});o.subscribe(m)})}(this.emoteApi.getEmotes(this.gameSettingsFormGroup.value.emotesSource));void 0!==t&&t.length>0?(this.emotes.white=this.emoteApi.getEmotes(this.gameSettingsFormGroup.value.emotesSource,u.B.DEFAULT_WHITE_EMOTE),this.emotes.black=this.emoteApi.getEmotes(this.gameSettingsFormGroup.value.emotesSource,u.B.DEFAULT_BLACK_EMOTE),yield this.messageService.createToast({header:"Settings",message:"Emotes have been updated!",color:"success",position:"top",buttons:["X"],duration:3e3})):yield this.messageService.createToast({header:"Settings error",message:"No emotes found!",color:"danger",position:"top",buttons:["X"],duration:3e3})})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A),e.Y36(G.G),e.Y36(u.B),e.Y36(l.qu),e.Y36(Q.e))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-settings"]],decls:45,vars:23,consts:[[1,"page-content-container"],[1,"title","ion-text-center","ion-padding-top","ion-padding-bottom"],["color","secondary"],[3,"formGroup"],["position","floating"],["formControlName","emotesSource",3,"clearInput"],["expand","block","color","secondary",3,"click"],[3,"control","emotes","player"],["formControlName","boardSize","interface","popover",1,"ion-padding-bottom"],[3,"value",4,"ngFor","ngForOf"],["formControlName","gameMode","interface","popover",1,"ion-padding-bottom"],[4,"ngIf"],["expand","block","color","secondary",3,"disabled","click"],[3,"value"],["position","floating",1,"ion-padding-bottom"],["color","secondary","formControlName","aiGameSpeed","min","0","max","5000","step","100"],["color","secondary","slot","start"],["color","secondary","slot","end"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-content")(1,"div",0)(2,"div",1)(3,"ion-label",2),e._uU(4),e.qZA()(),e.TgZ(5,"ion-grid",3)(6,"ion-row")(7,"ion-col")(8,"ion-item")(9,"ion-label",4),e._uU(10),e.qZA(),e._UZ(11,"ion-input",5),e.qZA()()(),e.TgZ(12,"ion-row")(13,"ion-col")(14,"ion-button",6),e.NdJ("click",function(){return n.updateEmotes()}),e._uU(15),e.qZA()()(),e.TgZ(16,"ion-row")(17,"ion-col"),e._UZ(18,"app-emote-select-item",7),e.ALo(19,"async"),e.qZA(),e.TgZ(20,"ion-col"),e._UZ(21,"app-emote-select-item",7),e.ALo(22,"async"),e.qZA()(),e.TgZ(23,"ion-row")(24,"ion-col")(25,"ion-item")(26,"ion-label",4),e._uU(27),e.qZA(),e.TgZ(28,"ion-select",8),e.YNc(29,Y,2,2,"ion-select-option",9),e.qZA()()()(),e.TgZ(30,"ion-row")(31,"ion-col")(32,"ion-item")(33,"ion-label",4),e._uU(34),e.qZA(),e.TgZ(35,"ion-select",10),e.YNc(36,j,2,2,"ion-select-option",9),e.qZA()()()(),e.YNc(37,q,11,3,"ng-container",11),e.TgZ(38,"ion-row")(39,"ion-col")(40,"ion-button",12),e.NdJ("click",function(){return n.saveGameSettings()}),e._uU(41),e.qZA()(),e.TgZ(42,"ion-col")(43,"ion-button",6),e.NdJ("click",function(){return n.resetGameSettingsForm()}),e._uU(44),e.qZA()()()()()()),2&t&&(e.xp6(4),e.Oqu("Game settings"),e.xp6(1),e.Q6J("formGroup",n.gameSettingsFormGroup),e.xp6(5),e.Oqu("7TV user"),e.xp6(1),e.Q6J("clearInput",!0),e.xp6(4),e.Oqu("Update emotes"),e.xp6(3),e.Q6J("control",n.gameSettingsFormGroup.controls.whiteEmote)("emotes",e.lcZ(19,19,n.emotes.white))("player","white"),e.xp6(3),e.Q6J("control",n.gameSettingsFormGroup.controls.blackEmote)("emotes",e.lcZ(22,21,n.emotes.black))("player","black"),e.xp6(6),e.Oqu("Board size"),e.xp6(2),e.Q6J("ngForOf",n.boardSizes),e.xp6(5),e.Oqu("Mode"),e.xp6(2),e.Q6J("ngForOf",n.gameModes),e.xp6(1),e.Q6J("ngIf",n.gameSettingsFormGroup.controls.gameMode.value===n.gameModes[2]),e.xp6(3),e.Q6J("disabled",n.isGameSettingsFormInvalid()),e.xp6(1),e.Oqu("Save"),e.xp6(3),e.Oqu("Reset"))},directives:[a.W2,a.Q$,a.jY,l.JL,l.sg,a.Nd,a.wI,a.Ie,a.pK,a.j9,l.JJ,l.u,a.YG,X,a.t9,a.QI,g.sg,a.n0,g.O5,a.I_],pipes:[g.Ov],styles:["[_nghost-%COMP%]   ion-select[_ngcontent-%COMP%]{justify-content:center;max-width:100%;width:100%;text-align:center}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{font-size:large;font-weight:700}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]{border-radius:5px}[_nghost-%COMP%]   .page-content-container[_ngcontent-%COMP%]{min-height:100%;display:flex;flex-direction:column;justify-content:center;align-content:center;align-items:center}"]}),o})()}];let $=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[b.Bz.forChild(R)],b.Bz]}),o})(),V=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[A],imports:[[g.ez,a.Pc,y,$,l.u5,l.UX]]}),o})()}}]);